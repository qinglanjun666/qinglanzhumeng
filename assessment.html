<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’è“å› - å¤§å­¦æ°”è´¨æµ‹è¯„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column; /* å‚ç›´å †å ï¼Œé¿å…é¡µè„šè·‘åˆ°å³ä¾§ */
            align-items: center;     /* æ°´å¹³å±…ä¸­å†…å®¹å®¹å™¨ */
            justify-content: flex-start; /* ä»é¡¶éƒ¨å¼€å§‹å¸ƒå±€ï¼Œé¿å…æ•´ä½“å±…ä¸­å¯¼è‡´é¡µè„šä½ç½®å¼‚å¸¸ */
            padding: 40px 0;        /* é¡¶éƒ¨ç•™ç™½ï¼Œæå‡è§‚æ„Ÿ */
        }

        .assessment-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            min-height: 600px;
            overflow: hidden;
            position: relative;
        }

        /* ç¡®ä¿ç«™ç‚¹åº•éƒ¨åœ¨è¯¥é¡µé¢ä¸‹å®½åº¦æ‹‰ä¼¸åˆ°å…¨å± */
        #site-footer { align-self: stretch; width: 100%; }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-bar {
            height: 4px;
            background: rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }

        .content {
            padding: 40px;
        }

        .question-page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .question-page.active {
            display: block;
        }

        .question-number {
            color: #667eea;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .options {
            display: grid;
            gap: 15px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .option-text {
            font-size: 1.1em;
            line-height: 1.5;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            /* ä¸‹ä¸€é¢˜æŒ‰é’®ï¼šæ”¹ä¸ºå“ç‰Œé’ç»¿è‰²åˆ°è“è‰²æ¸å˜ */
            background: linear-gradient(135deg, #2dc5a1 0%, #4f79ff 100%) !important;
            color: white !important;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 197, 161, 0.35);
        }

        .btn-secondary {
            /* ä¸Šä¸€é¢˜æŒ‰é’®ï¼šæ”¹ä¸ºå“ç‰Œè“è‰² */
            background: #4f79ff !important;
            color: white !important;
        }

        .btn-secondary:hover {
            background: #3e68f0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 60px 40px;
            position: relative;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        .loading-text {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .loading-subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .loading-steps {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .loading-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.3;
            transition: opacity 0.5s ease;
        }

        .loading-step.active {
            opacity: 1;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f4ff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 1.2em;
        }

        .step-icon.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            animation: bounce 0.6s ease;
        }

        .step-text {
            font-size: 0.9em;
            color: #666;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e9ecef;
            animation: dotPulse 1.5s infinite ease-in-out;
        }

        .progress-dot:nth-child(1) { animation-delay: 0s; }
        .progress-dot:nth-child(2) { animation-delay: 0.3s; }
        .progress-dot:nth-child(3) { animation-delay: 0.6s; }

        @keyframes dotPulse {
            0%, 80%, 100% { 
                transform: scale(0.8);
                background: #e9ecef;
            }
            40% { 
                transform: scale(1.2);
                background: #667eea;
            }
        }

        .results {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results.active {
            display: block;
        }

        .mood-result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .mood-name {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .mood-desc {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .universities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .university-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
            transition: transform 0.3s ease;
        }

        .university-card:hover {
            transform: translateY(-3px);
        }

        .university-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .university-location {
            color: #666;
            margin-bottom: 10px;
        }

        .university-desc {
            color: #555;
            line-height: 1.5;
        }

        .match-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .match-primary {
            background: #4CAF50;
            color: white;
        }

        .match-secondary {
            background: #FF9800;
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .restart-btn {
            margin-top: 30px;
        }

        /* MBTI é€‰é¡¹åˆ—è¡¨ */
        .mbti-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .mbti-item { background:#f8f9fa; border:1px solid #e9ecef; border-radius: 12px; padding: 14px; text-align:center; cursor:pointer; transition: all .2s ease; font-weight:600; }
        .mbti-item:hover { background:#f0f4ff; border-color:#667eea; transform: translateY(-2px); }
        .mbti-item .sub { display:block; font-size:.85em; color:#666; font-weight:400; margin-top:.25rem; }
        @media (max-width: 480px) { .mbti-grid { grid-template-columns: repeat(2, 1fr); } }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .assessment-container {
                width: 95%;
                margin: 10px;
                min-height: auto;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .content {
                padding: 20px;
            }

            .question-text {
                font-size: 1.2em;
            }

            .option {
                padding: 15px;
            }

            .option-text {
                font-size: 1em;
            }

            .navigation {
                flex-direction: column;
                gap: 15px;
                margin-top: 30px;
            }

            .btn {
                width: 100%;
                padding: 15px;
            }

            .loading-steps {
                flex-direction: column;
                gap: 15px;
            }

            .loading-step {
                flex-direction: row;
                gap: 10px;
            }

            .step-icon {
                margin-bottom: 0;
            }

            .universities-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .university-card {
                padding: 15px;
            }

            .mood-result {
                padding: 20px;
            }

            .mood-name {
                font-size: 1.5em;
            }

            .mood-desc {
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .assessment-container {
                width: 100%;
                margin: 0;
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 1em;
            }

            .content {
                padding: 15px;
            }

            .question-text {
                font-size: 1.1em;
            }

            .option {
                padding: 12px;
            }

            .loading {
                padding: 40px 20px;
            }

            .loading-text {
                font-size: 1.3em;
            }

            .loading-subtitle {
                font-size: 1em;
            }

            .step-icon {
                width: 35px;
                height: 35px;
                font-size: 1em;
            }

            .step-text {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div id="top-nav"></div>
    <div class="assessment-container">
        <div class="header">
            <h1>ğŸ¨ å¤§å­¦æ°”è´¨æµ‹è¯„</h1>
            <p>å‘ç°æœ€é€‚åˆä½ çš„å¤§å­¦ç±»å‹</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="content">
            <!-- åˆ—å‡ºæ‰€æœ‰ MBTI é€‰é¡¹ï¼Œç‚¹å‡»åè¿›å…¥è¯¥ç±»å‹å­¦æ ¡æ¨èé¡µ -->
            <section aria-label="MBTI ç±»å‹åˆ—è¡¨" style="margin:0 0 24px 0;padding:16px;background:#fff;border:1px solid #e9ecef;border-radius:12px;">
                <h3 style="margin:0 0 12px 0;color:#333;font-weight:600;">é€‰æ‹©ä½ çš„ MBTI ç±»å‹</h3>
                <div class="mbti-grid" id="mbtiList">
                    <div class="mbti-item" data-type="INTJ">INTJ<span class="sub">æˆ˜ç•¥å‹</span></div>
                    <div class="mbti-item" data-type="INTP">INTP<span class="sub">æ€è¾¨å‹</span></div>
                    <div class="mbti-item" data-type="INFJ">INFJ<span class="sub">æ´å¯Ÿå‹</span></div>
                    <div class="mbti-item" data-type="INFP">INFP<span class="sub">ç†æƒ³å‹</span></div>
                    <div class="mbti-item" data-type="ISTJ">ISTJ<span class="sub">ç¨³é‡å‹</span></div>
                    <div class="mbti-item" data-type="ISTP">ISTP<span class="sub">å®å¹²å‹</span></div>
                    <div class="mbti-item" data-type="ISFJ">ISFJ<span class="sub">å®ˆæŠ¤å‹</span></div>
                    <div class="mbti-item" data-type="ISFP">ISFP<span class="sub">æ¸©æŸ”å‹</span></div>
                    <div class="mbti-item" data-type="ENTJ">ENTJ<span class="sub">ç»Ÿå¸…å‹</span></div>
                    <div class="mbti-item" data-type="ENTP">ENTP<span class="sub">åˆ›æ–°å‹</span></div>
                    <div class="mbti-item" data-type="ENFJ">ENFJ<span class="sub">é¢†å¯¼å‹</span></div>
                    <div class="mbti-item" data-type="ENFP">ENFP<span class="sub">åˆ›æ„å‹</span></div>
                    <div class="mbti-item" data-type="ESTJ">ESTJ<span class="sub">ç®¡ç†å‹</span></div>
                    <div class="mbti-item" data-type="ESTP">ESTP<span class="sub">è¡ŒåŠ¨å‹</span></div>
                    <div class="mbti-item" data-type="ESFJ">ESFJ<span class="sub">å…³æ€€å‹</span></div>
                    <div class="mbti-item" data-type="ESFP">ESFP<span class="sub">æ´»åŠ›å‹</span></div>
                </div>
            </section>
            <!-- ï¼ˆå·²ç§»é™¤ï¼‰MBTI å¿«æ·è¾“å…¥å…¥å£ -->
            <!-- é—®é¢˜é¡µé¢ -->
            <div id="questionsContainer"></div>

            <!-- åŠ è½½é¡µé¢ -->
            <div class="loading" id="loadingPage">
                <div class="spinner"></div>
                <div class="loading-text">æ­£åœ¨ç”Ÿæˆä½ çš„ä¸“å±ç»“æœ</div>
                <div class="loading-subtitle">AIæ­£åœ¨æ·±åº¦åˆ†æä½ çš„ç­”æ¡ˆï¼Œè¯·ç¨å€™...</div>
                
                <div class="loading-steps">
                    <div class="loading-step" id="step1">
                        <div class="step-icon">ğŸ§ </div>
                        <div class="step-text">åˆ†æç­”æ¡ˆ</div>
                    </div>
                    <div class="loading-step" id="step2">
                        <div class="step-icon">ğŸ¯</div>
                        <div class="step-text">åŒ¹é…æ°”è´¨</div>
                    </div>
                    <div class="loading-step" id="step3">
                        <div class="step-icon">ğŸ«</div>
                        <div class="step-text">æ¨èå¤§å­¦</div>
                    </div>
                    <div class="loading-step" id="step4">
                        <div class="step-icon">âœ¨</div>
                        <div class="step-text">ç”ŸæˆæŠ¥å‘Š</div>
                    </div>
                </div>
                
                <div class="progress-dots">
                    <div class="progress-dot"></div>
                    <div class="progress-dot"></div>
                    <div class="progress-dot"></div>
                </div>
            </div>

            <!-- ç»“æœé¡µé¢ -->
            <div class="results" id="resultsPage">
                <div class="mood-result" id="moodResult">
                    <div class="mood-name" id="moodName"></div>
                    <div class="mood-desc" id="moodDesc"></div>
                </div>
                
                <h3>ä¸ºä½ æ¨èçš„å¤§å­¦</h3>
                <div class="universities-grid" id="universitiesGrid"></div>
                
                <button class="btn btn-primary restart-btn" onclick="restartAssessment()">
                    é‡æ–°æµ‹è¯„
                </button>
            </div>

            <!-- é”™è¯¯ä¿¡æ¯ -->
            <div id="errorMessage" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <script src="top-nav.js"></script>
    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let answers = [];
        let assessmentData = null;
        // åŠ¨æ€APIåŸºå€ï¼šåœ¨æ ¹ç›®å½•è¿è¡Œä½¿ç”¨ /apiï¼Œåœ¨å­è·¯å¾„åŒ…å« huilanweb æ—¶ä½¿ç”¨ /huilanweb/api
        const API_BASE = window.location.pathname.includes('huilanweb') ? '/huilanweb/api' : '/api';

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ä»…å±•ç¤º MBTI é€‰é¡¹åˆ—è¡¨ï¼Œç‚¹å‡»è·³è½¬æ¨èé¡µ
            const base = window.location.pathname.includes('huilanweb') ? '/huilanweb' : '';
            const list = document.getElementById('mbtiList');
            if (list) {
                list.querySelectorAll('.mbti-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const type = (item.getAttribute('data-type') || '').toUpperCase();
                        if (!/^[EI][NS][TF][JP]$/.test(type)) return;
                        window.location.href = `${base}/recommend.html?mbti=${encodeURIComponent(type)}`;
                    });
                });
            }
            // ä¸åŠ è½½é¢˜åº“ä¸é—®ç­”æµç¨‹
            const qc = document.getElementById('questionsContainer');
            if (qc) qc.style.display = 'none';
            const pb = document.getElementById('progressFill');
            if (pb) pb.style.width = '0%';
        });

        // åŠ è½½é¢˜ç›®
        async function loadQuestions() {
            try {
                const response = await fetch(`${API_BASE}/assessment/questions`);
                const data = await response.json();
                
                if (data.success) {
                    questions = data.data.questions;
                    renderQuestions();
                    showQuestion(0);
                } else {
                    showError('åŠ è½½é¢˜ç›®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            } catch (error) {
                showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•');
            }
        }

        // æ¸²æŸ“é¢˜ç›®
        function renderQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-page';
                questionDiv.id = `question-${index}`;
                
                questionDiv.innerHTML = `
                    <div class="question-number">é—®é¢˜ ${index + 1} / ${questions.length}</div>
                    <div class="question-text">${question.question_text}</div>
                    <div class="options">
                        ${question.options.map(option => `
                            <div class="option" data-option-id="${option.id}" onclick="selectOption(${index}, ${option.id})">
                                <div class="option-text">${option.option_text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" onclick="previousQuestion()" ${index === 0 ? 'style="visibility: hidden;"' : ''}>
                            ä¸Šä¸€é¢˜
                        </button>
                        <button class="btn btn-primary" id="nextBtn-${index}" onclick="nextQuestion()" disabled>
                            ${index === questions.length - 1 ? 'æäº¤æµ‹è¯„' : 'ä¸‹ä¸€é¢˜'}
                        </button>
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });
        }

        // æ˜¾ç¤ºæŒ‡å®šé¢˜ç›®
        function showQuestion(index) {
            // éšè—æ‰€æœ‰é¢˜ç›®
            document.querySelectorAll('.question-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºå½“å‰é¢˜ç›®
            const currentPage = document.getElementById(`question-${index}`);
            if (currentPage) {
                currentPage.classList.add('active');
                currentQuestionIndex = index;
                updateProgress();
            }
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(questionIndex, optionId) {
            // æ¸…é™¤å½“å‰é¢˜ç›®çš„å…¶ä»–é€‰æ‹©
            const questionPage = document.getElementById(`question-${questionIndex}`);
            questionPage.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // é€‰ä¸­å½“å‰é€‰é¡¹
            const selectedOption = questionPage.querySelector(`[data-option-id="${optionId}"]`);
            selectedOption.classList.add('selected');
            
            // ä¿å­˜ç­”æ¡ˆ
            answers[questionIndex] = optionId;
            
            // å¯ç”¨ä¸‹ä¸€é¢˜æŒ‰é’®
            const nextBtn = document.getElementById(`nextBtn-${questionIndex}`);
            nextBtn.disabled = false;
            
            // æ·»åŠ é€‰æ‹©åŠ¨ç”»æ•ˆæœ
            selectedOption.style.transform = 'scale(0.98)';
            setTimeout(() => {
                selectedOption.style.transform = 'scale(1)';
            }, 150);
            
            // ä¸å†è‡ªåŠ¨è·³é¢˜ï¼šä¿æŒå½“å‰é¡µï¼Œç”¨æˆ·ç‚¹å‡»â€œä¸‹ä¸€é¢˜â€ç»§ç»­
            // åœ¨æœ€åä¸€é¢˜æ—¶ï¼Œæ¿€æ´»æäº¤æç¤ºæ ·å¼
            if (questionIndex === questions.length - 1) {
                showSubmitConfirmation();
            }
        }

        // æ˜¾ç¤ºæäº¤ç¡®è®¤
        function showSubmitConfirmation() {
            const questionPage = document.getElementById(`question-${currentQuestionIndex}`);
            const nextBtn = document.getElementById(`nextBtn-${currentQuestionIndex}`);
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬å’Œæ ·å¼
            nextBtn.textContent = 'æäº¤æµ‹è¯„';
            nextBtn.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
            nextBtn.style.animation = 'pulse 2s infinite';
            
            // æ·»åŠ è„‰å†²åŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                    100% { transform: scale(1); }
                }
            `;
            document.head.appendChild(style);
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            } else {
                // æœ€åä¸€é¢˜ï¼Œæäº¤æµ‹è¯„
                submitAssessment();
            }
        }

        // ä¸Šä¸€é¢˜
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // å¯åŠ¨åŠ è½½æ­¥éª¤åŠ¨ç”»
         function startLoadingAnimation() {
             const steps = ['step1', 'step2', 'step3', 'step4'];
             let currentStep = 0;

             // é‡ç½®æ‰€æœ‰æ­¥éª¤
             steps.forEach(stepId => {
                 const step = document.getElementById(stepId);
                 const icon = step.querySelector('.step-icon');
                 step.classList.remove('active');
                 icon.classList.remove('active');
             });

             // é€æ­¥æ¿€æ´»æ¯ä¸ªæ­¥éª¤
             const activateStep = () => {
                 if (currentStep < steps.length) {
                     const step = document.getElementById(steps[currentStep]);
                     const icon = step.querySelector('.step-icon');
                     
                     step.classList.add('active');
                     icon.classList.add('active');
                     
                     currentStep++;
                     setTimeout(activateStep, 500); // æ¯500msæ¿€æ´»ä¸‹ä¸€æ­¥
                 }
             };

             activateStep();
         }

         // æäº¤æµ‹è¯„
         async function submitAssessment() {
             // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½å·²å›ç­”
             if (answers.length !== questions.length || answers.includes(undefined)) {
                 showError('è¯·å›ç­”æ‰€æœ‰é¢˜ç›®åå†æäº¤');
                 return;
             }

             // æ˜¾ç¤ºåŠ è½½é¡µé¢
             document.querySelectorAll('.question-page').forEach(page => {
                 page.classList.remove('active');
             });
             document.getElementById('loadingPage').classList.add('active');
             
             // å¯åŠ¨åŠ è½½æ­¥éª¤åŠ¨ç”»
             startLoadingAnimation();

             try {
                 const response = await fetch(`${API_BASE}/assessment/submit`, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({ answers: answers })
                 });

                 const data = await response.json();

                 if (data.success) {
                     assessmentData = data;
                     // ç­‰å¾…åŠ è½½åŠ¨ç”»å®Œæˆåæ˜¾ç¤ºç»“æœ
                     setTimeout(() => {
                         showResults(data);
                     }, 2000);
                 } else {
                     showError(data.message || 'æµ‹è¯„æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                     document.getElementById('loadingPage').classList.remove('active');
                 }
             } catch (error) {
                 showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•');
                 document.getElementById('loadingPage').classList.remove('active');
             }
         }

         // æ˜¾ç¤ºç»“æœ
         function showResults(data) {
             // éšè—åŠ è½½é¡µé¢
             document.getElementById('loadingPage').classList.remove('active');
             
             const moodResult = document.getElementById('moodResult');
             moodResult.style.background = `linear-gradient(135deg, ${data.user_mood.color || '#667eea'} 0%, #764ba2 100%)`;
             
             document.getElementById('moodName').textContent = data.user_mood.name;
             document.getElementById('moodDesc').textContent = data.user_mood.short_desc;

             const universitiesGrid = document.getElementById('universitiesGrid');
             universitiesGrid.innerHTML = '';

             data.matched_universities.forEach(university => {
                 const universityCard = document.createElement('div');
                 universityCard.className = 'university-card';
                 
                 universityCard.innerHTML = `
                     <div class="match-badge ${university.match_type === 'primary' ? 'match-primary' : 'match-secondary'}">
                         ${university.match_type === 'primary' ? 'å®Œç¾åŒ¹é…' : 'æ¨è'}
                     </div>
                     <div class="university-name">${university.name}</div>
                     <div class="university-location">${university.province} Â· ${university.city} Â· ${university.type}</div>
                     <div class="university-desc">${university.one_line}</div>
                 `;
                 // ç‚¹å‡»è·³è½¬å¤§å­¦è¯¦æƒ…é¡µ
                 universityCard.style.cursor = 'pointer';
                 universityCard.addEventListener('click', () => {
                     const base = window.location.pathname.includes('huilanweb') ? '/huilanweb' : '';
                     const DELETED_UNIVERSITY_IDS = new Set([11, 12]);
                     if (DELETED_UNIVERSITY_IDS.has(university.id)) {
                         alert('è¯¥é¡µé¢å·²åˆ é™¤ï¼šä¸æ˜¯å­¦æ ¡çš„å†…å®¹');
                         return;
                     }
                     window.location.href = `${base}/university.html?id=${university.id}`;
                 });
                 
                 universitiesGrid.appendChild(universityCard);
             });

             document.getElementById('resultsPage').classList.add('active');
         }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // é‡æ–°å¼€å§‹æµ‹è¯„
        function restartAssessment() {
            currentQuestionIndex = 0;
            answers = [];
            assessmentData = null;
            
            document.getElementById('resultsPage').classList.remove('active');
            document.getElementById('loadingPage').classList.remove('active');
            
            // æ¸…é™¤æ‰€æœ‰é€‰æ‹©
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // ç¦ç”¨æ‰€æœ‰ä¸‹ä¸€é¢˜æŒ‰é’®
            document.querySelectorAll('[id^="nextBtn-"]').forEach(btn => {
                btn.disabled = true;
            });
            
            showQuestion(0);
        }
    </script>
    <div id="site-footer"></div>
    <script src="site-footer.js"></script>
</body>
</html>